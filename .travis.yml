before_cache: 
  - "rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock"
  - "rm -f  $HOME/.gradle/caches/transforms-1/transforms-1.lock"
  - "rm -rf $HOME/.gradle/caches/*/fileHashes/"
  - "rm -rf $HOME/.gradle/caches/*/plugin-resolution/"
before_install: 
  - "export LANG=en_US.UTF-8"
  - "export CORDOVA_ANDROID_GRADLE_DISTRIBUTION_URL=http\\\\://services.gradle.org/distributions/gradle-4.1-all.zip"
  - "nvm install 8"
  - "npm install -g ionic cordova"
  - "openssl aes-256-cbc -K $encrypted_d72929d619b7_key -iv $encrypted_d72929d619b7_iv -in ./config/config.tar.enc -out ./config/config.tar -d"
  - "cd config"
  - "tar xvf config.tar"
  - "cd .."
before_script: 
  - echo "Before Script"
cache: 
  directories: 
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/
    - $HOME/.cache/yarn/v1/
deploy: 
  file: platforms/android/app/build/outputs/apk/**/*/ionictravis-*.apk
  file_glob: true
  provider: script
  repo: swayangjit/IonicTravis
  script: bash deploy.sh
  skip_cleanup: true
  true: 
    all_branches: true
    condition: $TRAVIS_BRANCH =~ ^release
env: 
  global: 
    - JAVA_HOME=/usr/lib/jvm/java-8-oracle
    - "BUILD_BRANCH=$(git ls-remote origin | sed -n \"\\|$TRAVIS_COMMIT\\s\\+refs/heads/|{s///p}\")"
matrix: 
  include: 
    - 
      addons: 
        apt: 
          packages: 
            - oracle-java8-installer
            - oracle-java8-set-default
            - yarn
            - jq
          sources: 
            - 
              key_url: "https://dl.yarnpkg.com/debian/pubkey.gpg"
              sourceline: "deb https://dl.yarnpkg.com/debian/ stable main"
      android: 
        components: 
          - tools
          - platform-tools
          - tools
          - build-tools-26.0.2
          - android-26
          - extra-google-google_play_services
          - extra-google-m2repository
          - extra-android-m2repository
      language: android
      licenses: 
        - android-sdk-preview-license-.+
        - android-sdk-license-.+
        - google-gdk-license-.+
      os: linux
      sudo: false
script: 
  - "./build.sh $BUILD_BRANCH"
